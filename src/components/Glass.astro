---
import "../styles/global.css";

import Pocketbase from "pocketbase";
const pb = new Pocketbase("https://tavue.paolo-vincent.fr/pb/");

const { monture, branche, verre } = Astro.props;

let MatMonture = await pb.collection("MatMonture").getFullList();
MatMonture.forEach((mat) => {
  mat.ImageURL = pb.files.getURL(mat, mat.Image, { thumb: "200x200" });
});
console.log(MatMonture);

let MatBranche = await pb.collection("MatBranche").getFullList();
MatBranche.forEach((mat) => {
  mat.ImageURL = pb.files.getURL(mat, mat.Image, { thumb: "200x200" });
});
console.log(MatBranche);

let TeinteVerre = await pb.collection("TeinteVerre").getFullList();
console.log(TeinteVerre);

function getCouleur(Nom) {
  const teinte = TeinteVerre.find(teinte => teinte.Nom === Nom);
  return teinte.Couleur;
};
---

<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  version="1.1"
  viewBox="0 0 406 157"
>
  <defs>
    <style>
      .shadow {
        fill: #706f6f;
        mix-blend-mode: multiply;
      }
      .verre {
        opacity: 0.75;
      }
    </style>

    <!-- pattern pour les montures -->
    {
      MatMonture.map((mat) => (
        <pattern
          id={mat.Nom + "Monture"}
          patternUnits="userSpaceOnUse"
          width="200"
          height="200"
        >
          <image
            href={mat.ImageURL}
            x="0"
            y="0"
            width="200"
            height="200"
            preserveAspectRatio="xMidYMid slice"
          />
        </pattern>
      ))
    }

    <!-- pattern pour les branches -->
    {
      MatBranche.map((mat) => (
        <pattern
          id={mat.Nom + "Branche"}
          patternUnits="userSpaceOnUse"
          width="200"
          height="200"
        >
          <image
            href={mat.ImageURL}
            x="0"
            y="0"
            width="200"
            height="200"
            preserveAspectRatio="xMidYMid slice"
          />
        </pattern>
      ))
    }
  </defs>
  <g>
    <g id="branches">
      <g id="droite">
        <path
          d="M5.85635 43.1428C5.85635 43.1428 55.2063 37.5728 60.7863 34.3828C66.3663 31.1928 71.9263 26.4228 80.2863 24.8328C88.6463 23.2428 144.766 13.6928 144.766 13.6928C144.766 13.6928 151.926 11.7028 162.276 19.2628C172.626 26.8228 195.316 51.1028 201.676 50.3128C208.046 49.5128 211.226 40.7628 209.236 36.7828C207.246 32.8028 168.566 4.0328 161.876 2.1528C152.346 -0.527197 139.986 -0.237198 124.856 2.1528C109.736 4.5428 8.63635 25.4928 8.63635 25.4928C8.63635 25.4928 -4.49365 31.6128 5.84635 43.1528L5.85635 43.1428Z"
          fill=`url(#${branche}Branche)`></path>
        <path
          class="shadow"
          d="M205.266 38.7628C205.266 38.7628 204.956 44.9128 201.286 44.3328C196.316 43.5528 165.466 10.5028 155.116 12.0928C155.116 12.0928 163.646 14.8028 173.576 23.7328C180.086 29.5928 207.996 61.5828 205.266 38.7628Z"
        ></path>
      </g>
      <g id="gauche">
        <path
          d="M271.816 67.6528L362.356 37.8728C362.356 37.8728 384.486 32.2428 387.706 33.8528C390.926 35.4628 405.416 64.4328 405.416 67.6528C405.416 70.8728 402.996 81.6628 399.786 82.5428C397.456 83.1828 394.456 82.6528 392.946 78.3328C391.536 74.3128 386.106 46.6028 380.476 46.8628C374.846 47.1228 329.776 62.8128 329.776 62.8128C329.776 62.8128 316.496 69.2528 310.866 74.0828C305.236 78.9128 278.676 85.3528 278.676 85.3528C278.676 85.3528 269.016 77.7028 271.836 67.6428L271.816 67.6528Z"
          fill=`url(#${branche}Branche)`></path>
        <path
          class="shadow"
          d="M382.386 46.0628C382.386 46.0628 385.646 46.0628 387.366 49.5128C389.086 52.9628 397.136 74.2228 397.136 74.2228C397.136 74.2228 397.906 79.2028 402.306 71.5428C402.306 71.5428 399.236 81.1028 396.946 78.3328C394.656 75.5628 387.176 52.0028 387.176 52.0028C387.176 52.0028 384.306 45.2628 382.386 46.0628Z"
        ></path>
        <path
          class="shadow"
          d="M278.366 68.1028C278.366 68.1028 380.636 32.9128 386.216 36.1128C386.216 36.1128 368.016 38.6028 344.456 47.9928C320.896 57.3828 278.366 70.0228 278.366 70.0228V68.1028Z"
        ></path>
      </g>
    </g>
    <g id="monture">
      <path
        d="M282.336 68.8128C282.096 65.4028 272.766 63.5928 269.626 62.4128C266.486 61.2328 253.926 64.3728 253.926 64.3728C241.756 61.2328 199.376 55.3428 175.046 55.3428C150.716 55.3428 142.476 66.7228 139.726 66.3328C136.976 65.9428 122.456 65.5528 116.176 64.3728C109.896 63.1928 111.076 50.2428 76.9264 37.8928C42.7864 25.5428 8.63645 25.4728 8.63645 25.4728C-4.71355 30.1328 1.87645 43.9628 1.87645 43.9628L3.92646 50.3128C8.24646 52.3428 7.06645 60.8328 8.63645 73.3928C10.2065 85.9528 16.0965 102.043 22.7665 111.853C29.4365 121.663 54.5564 132.653 67.1164 133.043C79.6764 133.433 90.6665 131.083 98.9065 117.733C107.146 104.393 115.786 80.8428 115.786 80.8428L125.986 82.4128C125.986 82.4128 128.896 82.7228 131.336 85.5028C133.776 88.2828 135.766 93.5328 138.936 102.813C146.496 124.913 164.056 142.063 164.056 142.063C164.056 142.063 169.656 149.493 197.496 154.723C220.576 159.063 240.196 152.263 240.196 152.263C257.916 145.093 261.826 107.303 261.826 107.303C261.826 107.303 263.656 94.0028 269.636 90.6528C277.006 86.5128 277.906 86.2128 282.346 85.3328C285.956 84.6228 282.586 72.2028 282.346 68.7928L282.336 68.8128ZM87.5265 119.323C78.1065 124.423 55.3465 126.383 41.2165 115.403C27.0865 104.413 20.4165 85.1828 18.4565 62.4228C16.4965 39.6628 25.5565 37.1928 25.5565 37.1928C25.5565 37.1928 40.4365 36.5228 59.6665 41.2228C78.8965 45.9328 100.086 59.2728 100.486 67.9128C100.876 76.5428 96.9564 114.223 87.5364 119.323H87.5265ZM241.756 143.653C232.726 147.973 220.286 148.363 209.826 147.573C199.366 146.793 172.286 146.003 162.476 116.173C162.476 116.173 159.726 102.043 157.376 98.9028C155.026 95.7628 147.956 84.4228 147.956 80.4728C147.956 72.2428 155.106 67.5028 155.106 67.5028C155.106 67.5028 163.266 62.4028 173.856 62.4028C184.456 62.4028 238.606 65.1528 246.066 75.3528C253.526 85.5528 253.126 97.3328 254.306 106.753C255.486 116.173 250.776 139.323 241.746 143.643L241.756 143.653Z"
        fill=`url(#${monture}Monture)`></path>
    </g>
    <g id="verres" class="verre">
      <path
        d="M13.3465 50.8728C12.4665 56.9228 13.7465 88.2828 24.7865 106.183C35.8265 124.083 61.8265 127.533 66.1565 127.493C70.4865 127.453 84.6665 128.513 90.6265 118.223C95.5965 109.633 103.796 74.7428 99.7465 65.1728C93.4865 50.3528 59.3465 41.1528 59.3465 41.1528C59.3465 41.1528 32.4965 35.6928 25.5265 36.6928C25.5265 36.6928 15.5565 35.7328 13.3565 50.8628L13.3465 50.8728Z"
      fill={getCouleur(verre)}></path>
      <path
        d="M144.346 80.5428C144.346 80.5428 143.256 70.9928 163.916 63.8528C175.676 59.7928 224.376 67.0828 224.376 67.0828C224.376 67.0828 243.466 71.1428 246.086 75.3628C248.706 79.5828 255.546 92.6028 254.376 113.333C253.236 133.543 247.066 140.133 241.766 143.643C241.766 143.643 234.666 148.573 220.426 149.573C193.776 151.453 183.416 148.433 174.236 141.843C144.356 120.383 144.356 80.5428 144.356 80.5428H144.346Z"
      fill={getCouleur(verre)}></path>
    </g>
  </g>
</svg>
