---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";
---

<Layout title="TaVue - Connexion">
  <div class="flex justify-center">
    <div class="card w-[500px]">
      <h1 class="text-5xl">Connecte-toi !</h1>
      <form id="loginForm" class="flex flex-col gap-2 w-full">
        <div class="flex flex-col flex-1">
          <label for="email">Email</label>
          <input
            class="input w-full"
            type="email"
            name="email"
            id="email"
            placeholder="Ton adresse email"
            required
          />
        </div>
        <div class="flex flex-col flex-1">
          <label for="password">Mot de passe</label>
          <input
            class="input w-full"
            type="password"
            name="password"
            id="password"
            placeholder="Ton mot de passe"
            minlength="8"
            required
          />
          <button type="submit" class="btn flex-1 btn-primary"
            >Se connecter</button
          >
        </div>
        <p id="msg" class="text-red-500"></p>
      </form>
    </div>

    <script>
      const form = document.getElementById("loginForm");
      const msg = document.getElementById("msg");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: form.email.value,
            password: form.password.value,
          }),
          credentials: "include", // ensures cookies are accepted
        });

        if (res.ok) {
          window.location.href = "/"; // redirect after successful login
        } else {
          const data = await res.json();
          msg.textContent = data.error;
        }
      });
    </script>
  </div>
</Layout>
