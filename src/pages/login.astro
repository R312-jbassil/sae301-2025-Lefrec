---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";
---

<Layout title="TaVue - Connexion">
  <div class="flex justify-center">
    <div class="card w-[500px]">
      <h1 class="text-5xl">Connecte-toi !</h1>
      <form id="loginForm" class="flex flex-col gap-2 w-full">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Mot de passe" required minlength="8" />
        <button type="submit">Se connecter</button>
      </form>
      <p id="msg" class="text-red-500"></p>
    </div>
  </div>

  <script>
    const form = document.getElementById("loginForm");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = form.email.value;
      const password = form.password.value;

      const res = await fetch("/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
        credentials: "include" // important if you want cookies sent/received
      });

      if (res.ok) {
        window.location.href = "/"; // redirect after login
      } else {
        const data = await res.json();
        msg.textContent = data.error;
      }
    });
  </script>
</Layout>
